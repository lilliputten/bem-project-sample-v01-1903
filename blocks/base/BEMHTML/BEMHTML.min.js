if(modules.isDefined("BEMHTML")){if(typeof window.BEMHTML!=="object"){modules.require(["BEMHTML"],function t(e){window.BEMHTML=e})}}else if(typeof window.BEMHTML==="object"){modules.define("BEMHTML",[],function t(e){e(BEMHTML)})}else{var BEMHTML;(function(i){function r(t){var e;var r=function(r,n){(function(t){if(typeof n==="object"&&typeof r!=="undefined"){r.exports=t()}else if(typeof define==="function"&&define.amd){define([],t)}else{var e;if(typeof window!=="undefined"){e=window}else if(typeof i!=="undefined"){e=i}else if(typeof self!=="undefined"){e=self}else{e=this}e.bemhtml=t()}})(function(){var t,e,r;return function s(o,a,h){function u(r,t){if(!a[r]){if(!o[r]){var e=typeof require=="function"&&require;if(!t&&e)return e(r,!0);if(c)return c(r,!0);var n=new Error("Cannot find module '"+r+"'");throw n.code="MODULE_NOT_FOUND",n}var i=a[r]={exports:{}};o[r][0].call(i.exports,function(t){var e=o[r][1][t];return u(e?e:t)},i,i.exports,s,o,a,h)}return a[r].exports}var c=typeof require=="function"&&require;for(var t=0;t<h.length;t++)u(h[t]);return u}({1:[function(t,e,r){var n=t("inherits");var i=t("../bemxjst/match").Match;var s=t("../bemxjst/entity").Entity;function o(t){this.bemxjst=t;this.jsClass=null;this.tag=new i(this,"tag");this.attrs=new i(this,"attrs");this.bem=new i(this,"bem");this.cls=new i(this,"cls");s.apply(this,arguments)}n(o,s);r.Entity=o;o.prototype.init=function(t,e){this.block=t;this.elem=e;this.jsClass=this.bemxjst.classBuilder.build(this.block,this.elem)};o.prototype._keys={tag:1,content:1,attrs:1,mix:1,js:1,mods:1,elemMods:1,cls:1,bem:1};o.prototype.defaultBody=function(t){t.mods=this.mods.exec(t);if(t.ctx.elem)t.elemMods=this.elemMods.exec(t);return this.bemxjst.render(t,this,this.tag.exec(t),this.js.exec(t),this.bem.exec(t),this.cls.exec(t),this.mix.exec(t),this.attrs.exec(t),this.content.exec(t),t.mods,t.elemMods)}},{"../bemxjst/entity":5,"../bemxjst/match":8,inherits:11}],2:[function(t,e,r){var n=t("inherits");var E=t("../bemxjst/utils");var i=t("./entity").Entity;var s=t("../bemxjst");function o(t){s.apply(this,arguments);this._shortTagCloser=typeof t.xhtml!=="undefined"&&t.xhtml?"/>":">";this._elemJsInstances=t.elemJsInstances;this._omitOptionalEndTags=t.omitOptionalEndTags;this._singleQuotesForDataAttrs=typeof t.singleQuotesForDataAttrs==="undefined"?false:t.singleQuotesForDataAttrs;this._unquotedAttrs=typeof t.unquotedAttrs==="undefined"?false:t.unquotedAttrs}n(o,s);e.exports=o;o.prototype.Entity=i;o.prototype.runMany=function(t){var e="";var r=this.context;var n=r.position;var i=r._notNewList;if(i){r._listLength+=t.length-1}else{r.position=0;r._listLength=t.length}r._notNewList=true;if(this.canFlush){for(var s=0;s<t.length;s++)e+=r._flush(this._run(t[s]))}else{for(var s=0;s<t.length;s++)e+=this._run(t[s])}if(!i)r.position=n;return e};o.prototype.render=function(t,e,r,n,i,s,o,a,h,u,c){var l=t.ctx;if(r===undefined)r="div";else if(!r)return h||h===0?this._run(h):"";var f="<"+r;if(n===true)n={};var p;if(n){p={};p[e.jsClass]=n}var d=typeof i!=="undefined"?i:e.block||e.elem;d=!!d;var m=d&&p&&(this._elemJsInstances?e.block:e.block&&!e.elem);if(!d&&!s)return this.renderClose(f,t,r,a,d,l,h);f+=" class=";var y="";if(d){y+=e.jsClass;y+=this.buildModsClasses(e.block,e.elem,e.elem?c:u);if(o){var v=this.renderMix(e,o,p,m);y+=v.out;p=v.jsParams;m=v.addJSInitClass}if(s)y+=" "+(typeof s==="string"?E.attrEscape(s).trim():s)}else{y+=typeof s==="string"?E.attrEscape(s).trim():s}if(m)y+=" i-bem";f+=this._unquotedAttrs&&E.isUnquotedAttr(y)?y:'"'+y+'"';if(d&&p)f+=" data-bem='"+E.jsAttrEscape(JSON.stringify(p))+"'";return this.renderClose(f,t,r,a,d,l,h)};var h={html:1,head:1,body:1,p:1,li:1,dt:1,dd:1,colgroup:1,thead:1,tbody:1,tfoot:1,tr:1,th:1,td:1,option:1,rb:1,rt:1,rtc:1,rp:1,optgroup:1};o.prototype.renderClose=function(t,e,r,n,i,s,o){var a=t;a+=this.renderAttrs(n);if(E.isShortTag(r)){a+=this._shortTagCloser;if(this.canFlush)a=e._flush(a)}else{a+=">";if(this.canFlush)a=e._flush(a);if(o||o===0)a+=this.renderContent(o,i);if(!this._omitOptionalEndTags||!h.hasOwnProperty(r))a+="</"+r+">"}if(this.canFlush)a=e._flush(a);return a};o.prototype.renderAttrs=function(t){var e="";if(E.isObj(t)){for(var r in t){var n=t[r];if(n===undefined||n===false||n===null)continue;if(n===true){e+=" "+r}else{var i=E.isSimple(n)?n:this.run(n);e+=" "+r+"=";e+=this._singleQuotesForDataAttrs&&r.indexOf("data-")===0?"'"+E.jsAttrEscape(i)+"'":this.getAttrValue(i)}}}return e};o.prototype.getAttrValue=function(t){return this._unquotedAttrs&&E.isUnquotedAttr(t)?t:'"'+E.attrEscape(t)+'"'};o.prototype.renderMix=function(t,e,r,n){var i={};var s=this.context;var o=r;var a=n;i[t.jsClass]=true;if(!Array.isArray(e))e=[e];var h=this.classBuilder;var u="";for(var c=0;c<e.length;c++){var l=e[c];if(!l)continue;if(typeof l==="string")l={block:l,elem:undefined};var f=false;if(l.elem){f=l.elem!==t.elem&&l.elem!==s.elem||l.block&&l.block!==t.block}else if(l.block){f=!(l.block===t.block&&l.mods)||l.mods&&t.elem}var p=l.block||l._block||s.block;var d=l.elem||l._elem||s.elem;var m=h.build(p,d);var y=l.elem||l._elem||(l.block?undefined:s.elem);if(f)u+=" "+h.build(p,y);u+=this.buildModsClasses(p,y,l.elem||!l.block&&(l._elem||s.elem)?l.elemMods:l.mods);if(l.js){if(!o)o={};o[h.build(p,l.elem)]=l.js===true?{}:l.js;if(!a)a=this._elemJsInstances?l.elem||p:p&&!l.elem}if(l.mix){var v=this.renderMix(t,l.mix,o,a);o=E.extend(o,v.jsParams);a=v.addJSInitClass;u+=v.out}if(!f||i[m])continue;i[m]=true;var x=this.entities[m];if(!x)continue;var b=s.block;var w=s.elem;var g=x.mix.exec(s);s.elem=w;s.block=b;if(!g)continue;for(var k=0;k<g.length;k++){var M=g[k];if(!M)continue;if(!M.block&&!M.elem||!i[h.build(M.block,M.elem)]){if(M.block)continue;M._block=p;M._elem=d;e=e.slice(0,c+1).concat(M,e.slice(c+1))}}}return{out:u,jsParams:o,addJSInitClass:a}};o.prototype.buildModsClasses=function(t,e,r){if(!r)return"";var n="";var i;for(i in r){if(!r.hasOwnProperty(i)||i==="")continue;var s=r[i];if(!s&&s!==0)continue;if(typeof s!=="boolean")s+="";var o=this.classBuilder;n+=" "+(e?o.buildElemClass(t,e,i,s):o.buildBlockClass(t,i,s))}return n}},{"../bemxjst":7,"../bemxjst/utils":10,"./entity":1,inherits:11}],3:[function(t,e,r){function n(t){this.elemDelim=t.elem||"__";this.modDelim=typeof t.mod==="string"?{name:t.mod||"_",val:t.mod||"_"}:{name:t.mod&&t.mod.name||"_",val:t.mod&&t.mod.val||"_"}}r.ClassBuilder=n;n.prototype.build=function(t,e){if(!e)return t;else return t+this.elemDelim+e};n.prototype.buildModPostfix=function(t,e){var r=this.modDelim.name+t;if(e!==true)r+=this.modDelim.val+e;return r};n.prototype.buildBlockClass=function(t,e,r){var n=t;if(r)n+=this.buildModPostfix(e,r);return n};n.prototype.buildElemClass=function(t,e,r,n){return this.buildBlockClass(t)+this.elemDelim+e+this.buildModPostfix(r,n)};n.prototype.split=function(t){return t.split(this.elemDelim,2)}},{}],4:[function(t,e,r){var n=t("./utils");function i(t){this._bemxjst=t;this.ctx=null;this.block="";this._currBlock="";this.elem=null;this.mods={};this.elemMods={};this.position=0;this._listLength=0;this._notNewList=false;this.escapeContent=t.options.escapeContent!==false}r.Context=i;i.prototype._flush=null;i.prototype.isSimple=n.isSimple;i.prototype.isShortTag=n.isShortTag;i.prototype.extend=n.extend;i.prototype.identify=n.identify;i.prototype.xmlEscape=n.xmlEscape;i.prototype.attrEscape=n.attrEscape;i.prototype.jsAttrEscape=n.jsAttrEscape;i.prototype.onError=function(t,e){console.error("bem-xjst rendering error:",{block:t.ctx.block,elem:t.ctx.elem,mods:t.ctx.mods,elemMods:t.ctx.elemMods},e)};i.prototype.isFirst=function(){return this.position===1};i.prototype.isLast=function(){return this.position===this._listLength};i.prototype.generateId=function(){return n.identify(this.ctx)};i.prototype.reapply=function(t){return this._bemxjst.run(t)}},{"./utils":10}],5:[function(t,e,r){var s=t("./utils");var i=t("./match").Match;var n=t("./tree");var o=n.Template;var a=n.PropertyMatch;var h=n.CompilerOptions;function u(t,e,r,n){this.bemxjst=t;this.block=null;this.elem=null;this.options={};this.canFlush=true;this.def=new i(this);this.mix=new i(this,"mix");this.js=new i(this,"js");this.mods=new i(this,"mods");this.elemMods=new i(this,"elemMods");this.content=new i(this,"content");this.rest={};this.init(e,r);this.initModes(n)}r.Entity=u;u.prototype.init=function(t,e){this.block=t;this.elem=e};u.prototype._keys={content:1,mix:1,js:1,mods:1,elemMods:1};u.prototype._initRest=function(t){if(t==="default"){this.rest[t]=this.def}else if(this._keys[t]){this.rest[t]=this[t]}else{this.rest[t]=this.rest[t]||new i(this,t)}};u.prototype.initModes=function(t){for(var e=0;e<t.length;e++){var r=t[e];for(var n=r.predicates.length-1;n>=0;n--){var i=r.predicates[n];if(!(i instanceof a))continue;if(i.key!=="_mode")continue;r.predicates.splice(n,1);this._initRest(i.value);this.rest[i.value].push(r);break}if(n===-1)this.def.push(r);for(var n=r.predicates.length-1;n>=0;n--){var i=r.predicates[n];if(!(i instanceof h))continue;this.options=s.extend(this.options,i.options)}}};u.prototype.prepend=function(t){var e=Object.keys(this.rest);for(var r=0;r<e.length;r++){var n=e[r];if(!t.rest[n])continue;this.rest[n].prepend(t.rest[n])}e=Object.keys(t.rest);for(var r=0;r<e.length;r++){var n=e[r];if(this.rest[n])continue;this._initRest(n);this.rest[n].prepend(t.rest[n])}};u.prototype.run=function(t){if(this.def.count!==0)return this.def.exec(t);return this.defaultBody(t)};function c(){return this.ctx.content}u.prototype.setDefaults=function(){if(this.content.count!==0)this.content.push(new o([],c));if(this.def.count!==0){this.canFlush=this.options.flush||false;var e=this;this.def.push(new o([],function t(){return e.defaultBody(this)}))}}},{"./match":8,"./tree":9,"./utils":10}],6:[function(t,e,r){function n(t,e){this.name="BEMXJSTError";this.message=t;if(Error.captureStackTrace)Error.captureStackTrace(this,e||this.constructor);else this.stack=(new Error).stack}n.prototype=Object.create(Error.prototype);n.prototype.constructor=n;r.BEMXJSTError=n},{}],7:[function(c,t,e){var r=c("inherits");var f=c("./tree").Tree;var l=c("./tree").PropertyMatch;var p=c("./tree").AddMatch;var n=c("./context").Context;var i=c("./class-builder").ClassBuilder;var s=c("./utils");function o(t){this.options=t;this.entities=null;this.defaultEnt=null;this.tree=null;this.match=null;this.contextConstructor=function t(e){n.call(this,e)};r(this.contextConstructor,n);this.context=null;this.classBuilder=new i(this.options.naming||{});this.depth=0;this.canFlush=false;this.oninit=null;this.defaultEnt=new this.Entity(this,"","",[]);this.defaultElemEnt=new this.Entity(this,"","",[])}t.exports=o;o.prototype.locals=f.methods.concat("local","applyCtx","applyNext","apply");o.prototype.runOninit=function(t,e){var r=e||this;r.BEMContext=this.contextConstructor;for(var n=0;n<t.length;n++){var i=t[n];i(r,{BEMContext:r.BEMContext})}};o.prototype.compile=function(t){var n=this;function r(){return n.run(n.context.ctx)}function i(){return n._run(n.context.ctx)}function e(t,e){if(!e)return n.local({ctx:t},r);return n.local(e,function(){return n.local({ctx:t},i)})}function s(t,e){if(!e)return n.local({ctx:t},i);return n.local(e,function(){return n.local({ctx:t},r)})}function o(t,e){return n.applyMode(t,e)}function a(r){return function t(e){return n.local(r,e)}}var h=new f({refs:{applyCtx:e,_applyCtx:s,apply:o}});var u=this.recompileInput(t);var c=h.build(u,[a,e,function t(e){if(e)return n.local(e,t);return n.applyNext()},o]);if(this.tree){this.runOninit(c.oninit);c={templates:c.templates.concat(this.tree.templates),oninit:this.tree.oninit.concat(c.oninit)}}this.tree=c;var l=this.groupEntities(c.templates);l=this.transformEntities(l);this.entities=l;this.oninit=c.oninit};o.prototype.getTemplate=function(t,e){this.compile(t,e);return this.exportApply()};o.prototype.recompileInput=function(t){var e=o.prototype.locals;if(typeof t==="function"&&t.length===e.length)return t;return new Function(e.join(", "),s.fnToString(t))};o.prototype.groupEntities=function(t){var e={};for(var r=0;r<t.length;r++){var n=t[r].clone();var i=null;var s;s=undefined;for(var o=0;o<n.predicates.length;o++){var a=n.predicates[o];if(!(a instanceof l)&&!(a instanceof p))continue;if(a.key==="block")i=a.value;else if(a.key==="elem")s=a.value;else continue;n.predicates.splice(o,1);o--}if(i===null){var h="block(…) subpredicate is not found.\n"+"    See template with subpredicates:\n     * ";for(var o=0;o<n.predicates.length;o++){var a=n.predicates[o];if(o!==0)h+="\n     * ";if(a.key==="_mode"){h+=a.value+"()"}else{if(Array.isArray(a.key)){h+=a.key[0].replace("mods","mod").replace("elemMods","elemMod")+"('"+a.key[1]+"', '"+a.value+"')"}else{h+="match(…)"}}}h+="\n    And template body: \n    ("+(typeof n.body==="function"?n.body:JSON.stringify(n.body))+")";if(typeof BEMXJSTError==="undefined"){BEMXJSTError=c("./error").BEMXJSTError}throw new BEMXJSTError(h)}var u=this.classBuilder.build(i,s);if(!e[u])e[u]=[];e[u].push(n)}return e};o.prototype.transformEntities=function(t){var e=[];var r=Object.keys(t);for(var n=0;n<r.length;n++){var i=r[n];var s=this.classBuilder.split(i);var o=s[0];var a=s[1];if(a==="*")e.push(o);t[i]=new this.Entity(this,o,a,t[i])}if(t.hasOwnProperty("*")){var h=t["*"];for(var n=0;n<r.length;n++){var i=r[n];if(i==="*")continue;t[i].prepend(h)}this.defaultEnt.prepend(h);this.defaultElemEnt.prepend(h)}for(var n=0;n<e.length;n++){var o=e[n];var u=this.classBuilder.build(o,"*");var h=t[u];for(var n=0;n<r.length;n++){var i=r[n];if(i===u)continue;var c=t[i];if(c.block!==o||c.elem===undefined)continue;t[i].prepend(h)}this.defaultElemEnt.prepend(h)}for(var n=0;n<r.length;n++){var i=r[n];t[i].setDefaults();this.defaultEnt.setDefaults();this.defaultElemEnt.setDefaults()}return t};o.prototype._run=function(t){if(t===undefined||t===""||t===null)return this.runEmpty();else if(Array.isArray(t))return this.runMany(t);else if(typeof t.html==="string"&&!t.tag&&typeof t.block==="undefined"&&typeof t.elem==="undefined"&&typeof t.cls==="undefined"&&typeof t.attrs==="undefined")return this.runUnescaped(t);else if(s.isSimple(t))return this.runSimple(t);return this.runOne(t)};o.prototype.run=function(t){var e=this.match;var r=this.context;var n=this.depth;this.match=null;this.context=new this.contextConstructor(this);this.canFlush=this.context._flush!==null;this.depth=0;var i=this._run(t);if(this.canFlush)i=this.context._flush(i);this.match=e;this.context=r;this.depth=n;return i};o.prototype.runEmpty=function(){this.context._listLength--;return""};o.prototype.runUnescaped=function(t){this.context._listLength--;return""+t.html};o.prototype.runSimple=function(t){this.context._listLength--;if(!t&&t!==0||t===true)return"";return typeof t==="string"&&this.context.escapeContent?s.xmlEscape(t):t};o.prototype.runOne=function(t){var e=this.context;var r=e.ctx;var n=e.block;var i=e._currBlock;var s=e.elem;var o=e.mods;var a=e.elemMods;if(t.block||t.elem)e._currBlock="";else e._currBlock=e.block;e.ctx=t;if(t.block){e.block=t.block;if(t.mods)e.mods=t.mods;else if(t.block!==n||!t.elem)e.mods={}}else{if(!t.elem)e.block="";else if(i)e.block=i}e.elem=t.elem;if(t.elemMods)e.elemMods=t.elemMods;else e.elemMods={};var h=e.block||"";var u=e.elem;if(h||u)e.position++;else e._listLength--;this.depth++;var c=false;var l=this.entities[this.classBuilder.build(h,u)];if(l){if(this.canFlush&&!l.canFlush){c=true;this.canFlush=false}}else{l=this.defaultEnt;if(u!==undefined)l=this.defaultElemEnt;l.init(h,u)}var f=this.options.production===true?this.tryRun(e,l):l.run(e);e.ctx=r;e.block=n;e.elem=s;e.mods=o;e.elemMods=a;e._currBlock=i;this.depth--;if(c)this.canFlush=true;return f};o.prototype.tryRun=function(e,t){try{return t.run(e)}catch(t){return e.onError(e,t)||""}};o.prototype.renderContent=function(t,e){var r=this.context;var n=r.position;var i=r._listLength;var s=r._notNewList;r._notNewList=false;if(e){r.position=0;r._listLength=1}var o=this._run(t);r.position=n;r._listLength=i;r._notNewList=s;return o};o.prototype.local=function(t,e){var r=Object.keys(t);var n=[];for(var i=0;i<r.length;i++){var s=r[i];var o=s.split(".");var a=this.context;for(var h=0;h<o.length-1;h++)a=a[o[h]];n.push({parts:o,value:a[o[h]]});a[o[h]]=t[s]}var u=e.call(this.context);for(var i=0;i<n.length;i++){var o=n[i].parts;var a=this.context;for(var h=0;h<o.length-1;h++)a=a[o[h]];a[o[h]]=n[i].value}return u};o.prototype.applyNext=function(){return this.match.exec(this.context)};o.prototype.applyMode=function(t,e){var r;var n=this.match;if(!n){var r=this.classBuilder.build(this.context.block,this.context.elem);n=this.entities[r].rest[t]}else{n=this.match.entity.rest[t]}if(!n){if(t==="mods")return this.context.mods;if(t==="elemMods")return this.context.elemMods;return this.context.ctx[t]}if(!e)return n.exec(this.context);var i=this;var s=function(){return n.exec(i.context)};return this.local(e,s)};o.prototype.exportApply=function(t){var e=this;var r=t||{};r.apply=function(t){return e.run(t)};r.compile=function(t){e.compile(t);return r};this.runOninit(e.oninit,r);return r}},{"./class-builder":3,"./context":4,"./error":6,"./tree":9,"./utils":10,inherits:11}],8:[function(t,e,r){var n=t("./tree");var o=n.PropertyMatch;var a=n.AddMatch;var h=n.WrapMatch;var u=n.ExtendMatch;var c=n.CustomMatch;function l(t,e){this.template=t;this.keys=e.key;this.value=e.value}l.prototype.exec=function(t){var e=t;for(var r=0;r<this.keys.length-1;r++){e=e[this.keys[r]];if(!e)return false}e=e[this.keys[r]];if(this.value===true)return e!==undefined&&e!==""&&e!==false&&e!==null;return String(e)===this.value};function f(t,e){this.template=t;this.body=e.body}f.prototype.exec=function(t){return this.body.call(t,t,t.ctx)};function p(t){this.template=t;this.wrap=null}p.prototype.exec=function(t){var e=this.wrap!==t.ctx;this.wrap=t.ctx;return e};function d(t){this.template=t;this.wrap=null}d.prototype.exec=function(t){var e=this.ext!==t.ctx;this.ext=t.ctx;return e};function m(t,e){this.template=t;this.key=e.key;this.value=e.value}m.prototype.exec=function(t){return t[this.key]===this.value};function i(t,e){this.mode=t;this.predicates=new Array(e.predicates.length);this.body=e.body;var r=[];for(var n=0,i=0;n<this.predicates.length;n++,i++){var s=e.predicates[n];if(s instanceof o){this.predicates[i]=new l(this,s)}else if(s instanceof u){i--;r.push(new d(this))}else if(s instanceof a){this.predicates[i]=new m(this,s)}else if(s instanceof c){this.predicates[i]=new f(this,s)}else if(s instanceof h){i--;r.push(new p(this))}else{i--}}for(var n=0;n<r.length;n++,i++)this.predicates[i]=r[n];if(this.predicates.length!==i)this.predicates.length=i}r.MatchTemplate=i;function s(t,e){this.entity=t;this.modeName=e;this.bemxjst=this.entity.bemxjst;this.templates=[];this.mask=[0];this.maskSize=0;this.maskOffset=0;this.count=0;this.depth=-1;this.thrownError=null}r.Match=s;s.prototype.prepend=function(t){this.templates=t.templates.concat(this.templates);this.count+=t.count;while(Math.ceil(this.count/31)>this.mask.length)this.mask.push(0);this.maskSize=this.mask.length};s.prototype.push=function(t){this.templates.push(new i(this,t));this.count++;if(Math.ceil(this.count/31)>this.mask.length)this.mask.push(0);this.maskSize=this.mask.length};s.prototype.tryCatch=function(t,e){try{return t.call(e,e,e.ctx)}catch(t){this.thrownError=t;if(this.modeName){this.thrownError.ctx=e;this.thrownError.name="BEMXJST ERROR";var r=this.entity.bemxjst.classBuilder;var n=t.stack.split("\n")[1];this.thrownError.message="Template error in mode "+this.modeName+" in block "+r.build(e.ctx.block,e.ctx.elem)+"\n    "+t.message+"\n";this.thrownError.stack=this.thrownError.name+": "+this.thrownError.message+" "+n+"\n"+t.stack}}};s.prototype.exec=function(t){var e=this.checkDepth();var r;var n=this.maskOffset;var i=this.mask[n];var s=1;for(var o=0;o<this.count;o++){if((i&s)===0){r=this.templates[o];for(var a=0;a<r.predicates.length;a++){var h=r.predicates[a];if(!h.exec(t))break}if(a===r.predicates.length)break}if(s===1073741824){n++;i=this.mask[n];s=1}else{s<<=1}}if(o===this.count){this.restoreDepth(e);if(this.modeName==="mods")return t.mods;if(this.modeName==="elemMods")return t.elemMods;return t.ctx[this.modeName]}var u=i;var c=this.bemxjst.match;this.mask[n]|=s;this.bemxjst.match=this;this.thrownError=null;var l;if(typeof r.body==="function")l=this.tryCatch(r.body,t);else l=r.body;this.mask[n]=u;this.bemxjst.match=c;this.restoreDepth(e);var f=this.thrownError;if(f!==null){this.thrownError=null;throw f}return l};s.prototype.checkDepth=function(){if(this.depth===-1){this.depth=this.bemxjst.depth;return-1}if(this.bemxjst.depth===this.depth)return this.depth;var t=this.depth;this.depth=this.bemxjst.depth;this.maskOffset+=this.maskSize;while(this.mask.length<this.maskOffset+this.maskSize)this.mask.push(0);return t};s.prototype.restoreDepth=function(t){if(t!==-1&&t!==this.depth)this.maskOffset-=this.maskSize;this.depth=t}},{"./tree":9}],9:[function(t,e,r){var n=t("inherits");var i=t("./utils");function s(t,e){this.predicates=t;this.body=e}r.Template=s;s.prototype.wrap=function(){var t=this.body;for(var e=0;e<this.predicates.length;e++){var r=this.predicates[e];t=r.wrapBody(t)}this.body=t};s.prototype.clone=function(){return new s(this.predicates.slice(),this.body)};function o(){}r.MatchBase=o;o.prototype.wrapBody=function(t){return t};function a(t,e){this.conditions=[];this.children=[];for(var r=e.length-1;r>=0;r--){var n=e[r];if(n instanceof o)this.conditions.push(n);else if(n===t.boundBody)this.children[r]=t.queue.pop();else this.children[r]=n}}function h(t){o.call(this);this.refs=t}n(h,o);r.WrapMatch=h;h.prototype.wrapBody=function(t){var e=this.refs._applyCtx;if(typeof t!=="function"){return function(){return e(t)}}return function(){return e(t.call(this,this,this.ctx))}};function u(t){o.call(this);this.refs=t}n(u,o);r.ReplaceMatch=u;u.prototype.wrapBody=function(t){var e=this.refs.applyCtx;if(typeof t!=="function"){return function(){return e(t,{position:this.position-1})}}return function(){return e(t.call(this,this,this.ctx),{position:this.position-1})}};function c(t){o.call(this);this.refs=t}n(c,o);r.ExtendMatch=c;c.prototype.wrapBody=function(i){var t=this.refs;var s=t.applyCtx;if(typeof i!=="function"){return function(){var t={};var e=Object.keys(i);for(var r=0;r<e.length;r++)t[e[r]]=i[e[r]];return s(this.ctx,t)}}return function(){var t={};var e=i.call(this,this,this.ctx);var r=Object.keys(e);for(var n=0;n<r.length;n++)t[r[n]]=e[r[n]];return s(this.ctx,t)}};function l(t,e){o.call(this);this.mode=t;this.refs=e}n(l,o);r.AddMatch=l;l.prototype.wrapBody=function(t){return this[this.mode+"WrapBody"](t)};l.prototype.appendContentWrapBody=function(t){var e=this.refs.apply;if(typeof t!=="function"){return function(){return[e("content"),t]}}return function(){return[e("content"),t.call(this,this,this.ctx)]}};l.prototype.prependContentWrapBody=function(t){var e=this.refs.apply;if(typeof t!=="function"){return function(){return[t,e("content")]}}return function(){return[t.call(this,this,this.ctx),e("content")]}};l.prototype.mixWrapBody=function(e){var r=this.refs.apply;if(typeof e!=="function"){return function(){var t=r("mix");if(!Array.isArray(t))t=[t];return t.concat(e)}}return function(){var t=r("mix");if(!Array.isArray(t))t=[t];return t.concat(e.call(this,this,this.ctx))}};["attrs","js","mods","elemMods"].forEach(function(r){l.prototype[r+"WrapBody"]=function(t){var e=this.refs.apply;return typeof t!=="function"?function(){return this[r]=i.extend(e(r)||{},t)}:function(){return this[r]=i.extend(e(r)||{},t.call(this,this,this.ctx))}}});function f(t){o.call(this);this.options=t}n(f,o);r.CompilerOptions=f;function p(t,e){o.call(this);this.key=t;this.value=e}n(p,o);r.PropertyMatch=p;function d(t){o.call(this);this.body=t}n(d,o);r.CustomMatch=d;function m(t){this.options=t;this.refs=this.options.refs;this.boundBody=this.body.bind(this);var e=this.methods("body");for(var r=0;r<e.length;r++){var n=e[r];this.boundBody[m.methods[r]]=n}this.queue=[];this.templates=[];this.initializers=[]}r.Tree=m;m.methods=["match","block","elem","mod","elemMod","oninit","xjstOptions","wrap","replace","extend","mode","def","content","appendContent","prependContent","attrs","addAttrs","js","addJs","mix","addMix","mods","addMods","addElemMods","elemMods","tag","cls","bem"];m.prototype.build=function(t,e){var r=this.methods("global").concat(e);r[0]=this.match.bind(this);t.apply({},r);return{templates:this.templates.slice().reverse(),oninit:this.initializers}};function y(n,t,i){var s=n[i];var o=n.boundBody;if(t!=="body"){if(i==="replace"||i==="extend"||i==="wrap"){return function(){return s.apply(n,arguments)}}return function(){s.apply(n,arguments);return o}}return function(){var t=s.apply(n,arguments);var e=n.queue.pop();var r=n.queue[n.queue.length-1];r.conditions=r.conditions.concat(e.conditions);r.children=r.children.concat(e.children);if(i==="replace"||i==="extend"||i==="wrap")return t;return o}}m.prototype.methods=function(t){var e=new Array(m.methods.length);for(var r=0;r<e.length;r++){var n=m.methods[r];e[r]=y(this,t,n)}return e};m.prototype.flush=function(t,e){var r=e.conditions?t.concat(e.conditions):e.conditions;for(var n=0;n<e.children.length;n++){var i=e.children[n];if(i instanceof a){this.flush(r,e.children[n])}else{if(this.isShortcutAllowed(i,t)){var s=Object.keys(i);for(var o=0;o<s.length;o++)this.addTemplate(t.concat(this.createMatch(s[o])),i[s[o]])}else{this.addTemplate(t,i)}}}};m.prototype.createMatch=function(t){switch(t){case"addAttrs":return[new p("_mode","attrs"),new l("attrs",this.refs)];case"addJs":return[new p("_mode","js"),new l("js",this.refs)];case"addMix":return[new p("_mode","mix"),new l("mix",this.refs)];case"addMods":return[new p("_mode","mods"),new l("mods",this.refs)];case"addElemMods":return[new p("_mode","elemMods"),new l("elemMods",this.refs)];case"appendContent":case"prependContent":return[new p("_mode","content"),new l(t,this.refs)];case"wrap":return new h(this.refs);case"replace":return new u(this.refs);case"extend":return new c(this.refs);case"def":return new p("_mode","default");default:return new p("_mode",t)}};m.prototype.addTemplate=function(t,e){var r=new s(t,e);r.wrap();this.templates.push(r)};m.prototype.body=function(){var t=new Array(arguments.length);for(var e=0;e<arguments.length;e++)t[e]=arguments[e];var r=new a(this,t);this.queue[this.queue.length-1].children.push(r);if(this.queue.length===1)this.flush([],this.queue.shift());return this.boundBody};m.modsCheck={mods:1,elemMods:1};m.checkConditions=function(t){for(var e=0;e<t.length;e++){var r=t[e];if(r.key==="block"||r.key==="elem"||Array.isArray(r.key)&&m.modsCheck[r.key[0]]||r instanceof d)continue;return false}return true};m.prototype.isShortcutAllowed=function(t,e){return typeof t==="object"&&t!==null&&!Array.isArray(t)&&m.checkConditions(e)};m.prototype.match=function(){var t=new Array(arguments.length);if(!arguments.length)throw new Error(".match() must have argument");for(var e=0;e<arguments.length;e++){var r=arguments[e];if(typeof r==="function")r=new d(r);if(!(r instanceof o))throw new Error("Wrong .match() argument");t[e]=r}this.queue.push(new a(this,t));return this.boundBody};m.prototype.applyMode=function(t,e){if(t.length){throw new Error("Predicate should not have arguments but "+JSON.stringify(t)+" passed")}return this.mode(e)};m.prototype.xjstOptions=function(t){this.queue.push(new a(this,[new f(t)]));return this.boundBody};["mode","elem","block"].forEach(function(e){m.prototype[e]=function(t){return this.match(new p(e==="mode"?"_mode":e,t))}});["mod","elemMod"].forEach(function(r){m.prototype[r]=function(t,e){return this.match(new p([r+"s",t],e===undefined?true:String(e)))}});m.prototype.def=function(){return this.applyMode(arguments,"default")};["content","mix","bem","js","cls","attrs","tag","elemMods","mods"].forEach(function(t){m.prototype[t]=function(){return this.applyMode(arguments,t)}});["appendContent","prependContent"].forEach(function(t){m.prototype[t]=function(){return this.content.apply(this,arguments).match(new l(t,this.refs))}});function v(t){return t[0].toUpperCase()+t.slice(1)}["mods","elemMods","attrs","js","mix"].forEach(function(t){m.prototype["add"+v(t)]=function(){return this[t].apply(this,arguments).match(new l(t,this.refs))}});m.prototype.wrap=function(){return this.def.apply(this,arguments).match(new h(this.refs))};m.prototype.replace=function(){return this.def.apply(this,arguments).match(new u(this.refs))};m.prototype.extend=function(){return this.def.apply(this,arguments).match(new c(this.refs))};m.prototype.oninit=function(t){this.initializers.push(t)}},{"./utils":10,inherits:11}],10:[function(t,e,r){var a="&amp;";var h="&lt;";var u="&gt;";var c="&quot;";var l="&#39;";var f=/[&<>]/;function p(t){return typeof t==="undefined"||t===null||typeof t==="number"&&isNaN(t)}r.xmlEscape=function(t){if(p(t))return"";var e=""+t;var r=f.exec(e);if(!r)return e;var n;var i="";var s=0;var o=0;for(s=r.index;s<e.length;s++){switch(e.charCodeAt(s)){case 38:n=a;break;case 60:n=h;break;case 62:n=u;break;default:continue}if(o!==s)i+=e.substring(o,s);o=s+1;i+=n}return o!==s?i+e.substring(o,s):i};var d=/["&]/;r.attrEscape=function(t){if(p(t))return"";var e=""+t;var r=d.exec(e);if(!r)return e;var n;var i="";var s=0;var o=0;for(s=r.index;s<e.length;s++){switch(e.charCodeAt(s)){case 34:n=c;break;case 38:n=a;break;default:continue}if(o!==s)i+=e.substring(o,s);o=s+1;i+=n}return o!==s?i+e.substring(o,s):i};var m=/['&]/;r.jsAttrEscape=function(t){if(p(t))return"";var e=""+t;var r=m.exec(e);if(!r)return e;var n;var i="";var s=0;var o=0;for(s=r.index;s<e.length;s++){switch(e.charCodeAt(s)){case 38:n=a;break;case 39:n=l;break;default:continue}if(o!==s)i+=e.substring(o,s);o=s+1;i+=n}return o!==s?i+e.substring(o,s):i};r.extend=function(t,e){if(!t||!e)return t||e;var r={};var n;for(n in t)if(t.hasOwnProperty(n))r[n]=t[n];for(n in e)if(e.hasOwnProperty(n))r[n]=e[n];return r};var n={area:1,base:1,br:1,col:1,command:1,embed:1,hr:1,img:1,input:1,keygen:1,link:1,meta:1,param:1,source:1,wbr:1};r.isShortTag=function(t){return n.hasOwnProperty(t)};r.isSimple=function t(e){if(!e||e===true)return true;if(!e.block&&!e.elem&&!e.tag&&!e.cls&&!e.attrs&&e.hasOwnProperty("html")&&t(e.html))return true;return typeof e==="string"||typeof e==="number"};r.isObj=function(t){return t&&typeof t==="object"&&!Array.isArray(t)&&t!==null};var i=0;var s=+new Date;var o="__"+s;var y="uniq"+s;function v(){return y+ ++i}r.getUniq=v;r.identify=function(t,e){if(!t)return v();if(e||t[o])return t[o];var r=v();t[o]=r;return r};r.fnToString=function(t){if(!t)return"";if(typeof t==="function"){t=t.toString();t=t.replace(t.indexOf("function")===0?/^function\s*[^{]+{|}$/g:/^(_|\(\w|[^=>]+\))\s=>\s{|}$/g,"")}return t};var x=/^[:\w.-]+$/;r.isUnquotedAttr=function(t){return t&&x.exec(t)}},{}],11:[function(t,e,r){if(typeof Object.create==="function"){e.exports=function t(e,r){e.super_=r;e.prototype=Object.create(r.prototype,{constructor:{value:e,enumerable:false,writable:true,configurable:true}})}}else{e.exports=function t(e,r){e.super_=r;var n=function(){};n.prototype=r.prototype;e.prototype=new n;e.prototype.constructor=e}}},{}]},{},[2])(2)});return r.exports||n.BEMHTML}({},{});var n=new r({elemJsInstances:true,exportName:"BEMHTML",to:"BEMHTML.js"});n.compile(function(t,e,r,n,i,s,o,a,h,u,c,l,f,p,d,m,y,v,x,b,w,g,k,M,E,_,B,j,C,A,T,O){s(function(t,e){var r=t.BEMContext||e.BEMContext;r.prototype.require=function(t){return this._libs[t]}})});e=n.exportApply(e);if(t)e.BEMContext.prototype._libs=t;return e}var n=this.window||this.global||this;var t=typeof exports!=="undefined"?exports:i;if(typeof modules==="object"){modules.define("BEMHTML",[],function(t){var e=n.BEMHTML=r({});t(e)})}else{var e={};if(Object.keys(e).length){BEMHTML=r(e);t["BEMHTML"]=BEMHTML;t["BEMHTML"].libs=e}else{BEMHTML=r(n);t["BEMHTML"]=BEMHTML;t["BEMHTML"].libs=n}}})(typeof window!=="undefined"?window:typeof global!=="undefined"?global:this)}
